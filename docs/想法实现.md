# TODO: 升级更新处理器验证器

记录一些想法实现的过程或失败或成功

## 丰富验证器和其他细节

根据测试库中的异常字段排查尝试验证, 根据智库, RDB新闻, NLP新闻, 中央网站的经验编写脚本处理器

TODO:验证器不设置下限, 只拦截处理error:开头的数据值和上限长度拦截

处理器处理下限根据条件返回error:text或返回正常的空值

根据字段设置平均长度上限 减少误拦截概率

-   [x] 时间验证器 + 脚本处理器模板

    验证器简单的验证时间格式化后的时间是否超出当前时间, 出现此类问题的原因是时间格式化功能过于强大导致的

    脚本处理器模板中用正则提取常见中文时间格式由时间格式化处理器处理

-   [x] 作者验证器 + 脚本处理器模板

    验证器暂时判断长度在2-4个之间, 并拦截处理器返回的提取失败的结果, 调度跑起来以后配置人员自行调整区间

    处理器模板中替换掉标志文字如作者编辑等, 然后用正则列表表达式列表分别提取中文字符或英文加数字连续字符, 然后替换文字中间的空格, 提取失败返回带有error:前缀的结果

-   [x] 来源验证器 + 脚本处理器模板

    验证器拦截提取失败的结果

    处理器模板替换屌标志文字如来源转自, 然后用正则提取连续中文字符, 失败返回带有error:前缀的结果

-   [x] 标签验证器 + 脚本处理器模板

    验证器与作者部分相同, 标签长度在2-5之间否则不通过

    处理器与作者部分相同, 替换标签的标志文字

-   [x] 新闻类型验证器

    同标签验证器

-   [x] 链接验证器

    验证url是否合法, 除了新增连接无法使用验证器, 其他字段涉及到url都有添加, 主要拦截附件的非法链接, 如链接地址没有拓展或格式错误, 有模板提供的通用xpath应该作用发挥不到

-   [x] 标题验证器

    验证标题结尾是否有省略号, 在列表页拦截

-   [x] 网站名验证器

    柯玉强复制带了空格

-   [x] 行处理器

    计算md5之外还可以给数组字段去重, 去空, 字段可能不存在, 需要预判一下

    字段设置那个去重, 不能处理经过处理器处理后的结果
    
-   [x] 规范化处理器脚本

    统一格式, 添加可以增加预处理部分
    
-   [x] 时间处理器增加处理 1个小时前 的功能

    从猿急送项目复制过来

-   [x] 作者优化

-   [x] 来源优化

-   [x] 标签优化

-   [x] 新闻类型优化

    不做处理器了, 需要处理的情况非常少见需要的时候可以自己写脚本处理

-   [x] 链接优化

-   [x] 附件添加mp4

-   [x] 标题优化

-   [x] 网站名优化

-   [ ] 附件去重

    脚本处理器写好了, 但还是决定不加了

-   [ ] 测试模板

    整理遗留配置使用新模板做测试

-   [ ] 

以上处理器和验证器涉及到标志性文字的, 需要不断的收集添加到模板中, 浏览详情页去收集



## 其他细节可优化的

-   [ ] 配置自动加载最新模版【十分期待】70% 

    完成了下载配置读取关键xpath表达式手动复制到新模板中了

    利用code_object读取处理器和验证器源码, 做个base模板用jinjia2生成自定义模板

    用selenium提交配置, 并运行测试, 成功后保存配置

-   [x] 详情页加refer存到附加字段

    胡涛涛提出的建议, 直接减少了数据量核验中发现数据量少, 发现解决的时间大量减少

-   [x] 调度进度查看脚本

    编写可以根据user_id扫描卡住的配置及时排错, 已有现成脚本, 只需要稍微修改即可使用

-   [x] 自审文档生成脚本

-   [ ] 流程图说明质量控制

    第三或四周, 配置和维护的速度稳定后整理一下流程, 分享经验

-   [ ] 演示修改配置为最新模版

    有遗留一部分配置没有使用新的模板, 需要利用脚本做一部分工作, 剩下配置人员来做

-   [x] 开发日报脚本用Jenkins定时, 自动生成markdown格式表格, 发到叮叮给海松

    脚本编写测试完成, 需要跟海松确定格式, Jenkins还没安装, 第二周周末前弄完, 可以先手动运行

    需求变更, 使用自审文档, 给海松用, 现在发现详细的日报也有用, 可以继续

-   [x] 测试库中的数据何时可以删除, 如配置通过审核或配置上线跑完历史

    跟负责人沟通确定一下, 防止测试库数据过多, 影响进度

    通过审核就可以删除, 上线的时候删吧

-   [x] 详细监控

    用influxdb记录每个人的配置完成总数, 自审完成总数, 上线配置总数和差值, 展示每个人的能力, grafana

    还不清楚具体如何实现, 但感觉很需要, 网站多了不好做整体的监控, 也不好判断个人的配置能力

    可以和爬虫那边的人了解一哈子

    本地搞个批次记录表哈哈哈

-   [ ] TODO 创建调度 设置报警人员

-   [x] 统一脚本处理器模板

-   [x] 第三周周末, 做个模板生成的脚本, 可以从数据库读取字段生成base模板, 然后添加脚本处理器和生成器到base模板生成自定义模板, 可以用于其他采集文档的网站上, 也避免手动维护出错的可能

-   [ ] TODO 修改验证器

    在验证器中打印异常字段值到日志, 加快调整验证条件的速度, 省去再做测试用例的时间

